<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Image Resizer & Converter</title>
    <style>
      body {
        font-family: sans-serif;
        max-width: 600px;
        margin: 2rem auto;
      }
      input,
      select,
      button {
        margin-top: 1rem;
        display: block;
        width: 100%;
        padding: 0.5rem;
      }
      #output {
        margin-top: 2rem;
      }
      a {
        display: block;
        margin-top: 0.5rem;
        color: #2563eb;
      }
    </style>
  </head>
  <body>
    <h1>Product Image Resizer & Converter</h1>

    <input type="file" id="inputFile" accept="image/*" />
    <label>Output widths (comma-separated, e.g., 150,300,600)</label>
    <input type="text" id="widths" value="150,300,600,1200" />

    <label>Formats</label>
    <select id="formats" multiple>
      <option value="image/jpeg" selected>JPEG</option>
      <option value="image/webp" selected>WebP</option>
      <option value="image/avif">AVIF</option>
    </select>

    <button id="generate">Generate Images</button>

    <div id="output"></div>

    <script>
      document
        .getElementById('generate')
        .addEventListener('click', async () => {
          const fileInput = document.getElementById('inputFile');
          const widthsInput = document.getElementById('widths').value;
          const formatsSelect = Array.from(
            document.getElementById('formats').selectedOptions,
          ).map((o) => o.value);

          const outputDiv = document.getElementById('output');
          outputDiv.innerHTML = '';

          if (!fileInput.files.length) return alert('Select an image first!');
          const file = fileInput.files[0];

          const img = new Image();
          img.src = URL.createObjectURL(file);

          await new Promise((r) => (img.onload = r));

          const widths = widthsInput
            .split(',')
            .map((s) => parseInt(s.trim()))
            .filter(Boolean);

          for (const width of widths) {
            const scale = width / img.width;
            const height = img.height * scale;

            const canvas = document.createElement('canvas');
            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, width, height);

            for (const fmt of formatsSelect) {
              const blob = await new Promise((resolve) =>
                canvas.toBlob(resolve, fmt, 0.8),
              );
              const ext = fmt.split('/')[1];
              const url = URL.createObjectURL(blob);
              const link = document.createElement('a');
              link.href = url;
              link.download = `${file.name.replace(/\.[^.]+$/, '')}-${width}.${ext}`;
              link.textContent = `Download ${width}px ${ext}`;
              outputDiv.appendChild(link);
            }
          }
        });
    </script>
  </body>
</html>
